<section id="abaixo-assinado-home">
    <div class="news-home">
        <div class="container noticias-header">
            <h1 class="news-home-title">loja</h1>
            <h5 class="header-subtitle">colabore com a sustentabilidade comprando produtos recicl√°veis!</h4>
        </div>
    </div>
</section>
<ul class="nav justify-content-center">
    <a class="navbar-brand nav-link active nav-link-loja" href="/loja/carrinho"><i class="fa fa-shopping-cart icon-large"></i> Seu Carrinho ({{num_itens}})</a>
</ul>

<section id="loja">
<div class="row">
   {{#each produtos}}
  <div class="card col-sm-3">
    <img class="loja-card-img-top" src="{{img}}" alt="Imagem de capa do card">
    <div class="card-body">
      <h5 class="card-title">{{titulo}}</h5>
      <p class="card-text">{{descricao}}</p>
      <p class="card-text h4">R${{preco}}</p>
      <br>
      <div class="row">
        <label for="qtd" class="col-sm-6">Quantidade: </label>
        <input type="number" id="qtd" class="col-sm-6 input-loja">
      </div>
      <div class="col text-center">
        <button onclick="salvaCarrinho('{{id}}')" class="btn btn-success btn-adote">Adicionar ao carrinho</button>  
      </div>
    </div>
  </div>
  {{/each}}
</div>
<script type="text/javascript">
    // const salvaCarrinho = (id) => {
    //     const qtd = document.getElementById("qtd").value;
    //   try {
    //     var request = new XMLHttpRequest();
    //     request.open('POST', '/loja/carrinho', true);
    //     request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

    //     const body = {id, qtd}
    //     request.send(JSON.stringify(body))
    //     .then(res => {
    //       console.log(ok)
    //       Swal.fire(res).then(result => {
    //           if (result.value) window.location = '/loja';
    //       })
    //     });
    //     console.log('Completed!', request);
    //   } catch(err) {
    //     console.error(`Error: ${err}`);
    //   }
    // };
    const salvaCarrinho = (id) => {
      const qtd = document.getElementById("qtd").value; 
      $.ajax({
          url: '/loja/carrinho',
          method: 'post',
          data: {id, qtd}
      }).done(d => {
          Swal.fire(d).then(result => {
              if (result.value) window.location = '/loja';
          })
      })
    };
</script>